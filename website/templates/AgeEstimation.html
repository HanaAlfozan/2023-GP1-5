{% load static %}
{% block brand %}
<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="{% static 'images/GGicon.png' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">


    <style>
            body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
   

        #video-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #video-stream {
            max-width: 100%;
            max-height: 100%;
        }

        #button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
     

        button {
            margin: 10px 0;
        }
    </style>

</head>

<header>
    <div class="logo">
        <img src="{% static 'images/GameGeek.png' %}" alt="Logo">
    </div>
    <nav class="navbar">
        <ul>
            <li><a href="{% url 'Game' %}">Home</a></li>
            <li><a href="{% url 'Fav' %}">Favourites</a></li>
            <li><a href="{% url 'History' %}">History</a></li>
            <li><a href="{% url 'profile' %}">Profile</a></li>
            <li><a href=#>Contact us</a></li>
            <li><a href="{% url 'index' %}">Log out</a></li>
        </ul>
    </nav>
</header>   


<body>

    <div id="video-container">
        <video id="video-stream" autoplay playsinline></video>
    </div>

    <img id="captured-image" src="" alt="Captured Image" style="display: none;">
        <div id="button-container">
        <button id="take-snapshot-button" disabled class="cta-button">Take Snapshot</button>
        <button id="retake-button" style="display: none;" class="cta-button">Retake</button>
        <a id="save-button" class="cta-button" href="index.html" download="snapshot.jpg" style="display: none;">Save</a>
        <a id="next-button" class="cta-button" href="GamesPage.html"  style="display: none;">Next</a>

    </div>
    <script>
        // JavaScript code for capturing and saving the image
        document.addEventListener('DOMContentLoaded', () => {
            const takeSnapshotButton = document.getElementById('take-snapshot-button');
            const retakeButton = document.getElementById('retake-button');
            const capturedImage = document.getElementById('captured-image');
            const videoElement = document.getElementById('video-stream');
            const saveButton = document.getElementById('save-button');
            const nextButton = document.getElementById('next-button');


            let mediaStream;
            let snapshotDataUrl;

            // Start the camera immediately when the page loads
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    mediaStream = stream;
                    videoElement.srcObject = mediaStream;

                    // Enable the "Take Snapshot" button
                    takeSnapshotButton.disabled = false;
                })
                .catch(error => {
                    console.error('Error accessing camera:', error);
                });

            takeSnapshotButton.addEventListener('click', () => {
                if (mediaStream) {
                    const canvas = document.createElement('canvas');
                    canvas.width = videoElement.videoWidth;
                    canvas.height = videoElement.videoHeight;
                    const context = canvas.getContext('2d');
                    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

                    // Convert the captured snapshot to base64 data
                    snapshotDataUrl = canvas.toDataURL('image/jpeg');

                    // Display the captured image and hide the video element
                    capturedImage.src = snapshotDataUrl;
                    capturedImage.style.display = 'block';
                    videoElement.style.display = 'none';

                    // Show the "Retake" and "Save" buttons
                    retakeButton.style.display = 'block';
                    saveButton.style.display = 'block';
                    nextButton.style.display = 'block';


                    // Disable the "Take Snapshot" button
                    takeSnapshotButton.disabled = true;
                }
            });

            retakeButton.addEventListener('click', () => {
                // Reset the captured image and show the video element
                capturedImage.src = '';
                capturedImage.style.display = 'none';
                videoElement.style.display = 'block';

                // Hide the "Retake" and "Save" and "Next" buttons
                retakeButton.style.display = 'none';
                saveButton.style.display = 'none';
                nextButton.style.display = 'none';


                // Enable the "Take Snapshot" button
                takeSnapshotButton.disabled = false;
            });

            saveButton.addEventListener('click', () => {
                // Trigger the download of the captured image
                saveButton.href = snapshotDataUrl;
            });

            nextButton.addEventListener('click', () => {
                // Trigger the download of the captured image
                saveButton.href = "GamesPage.html";
            });
        });
    </script>
</body>
{% endblock %}
</html>
