{% load static %}
{% block brand %}
{% csrf_token %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" type="image/x-icon" href="{% static 'images/GGicon.png' %}">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Age estimations</title>
	<!-- favicon -->
    <link rel="shortcut icon" type="image/png" href="{% static 'img/Games/GGicon.png' %}">

	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:00,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="{% static 'css/all.min.css' %}">
	<!-- bootstrap -->
	<link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
	<!-- owl carousel -->
	<link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
	<!-- magnific popup -->
	<link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
	<!-- animate css -->
	<link rel="stylesheet" href="{% static 'css/animate.css' %}">
	<!-- mean menu css -->
	<link rel="stylesheet" href="{% static 'css/meanmenu.min.css' %}">
	<!-- main style -->
	<link rel="stylesheet" href="{% static 'css/main.css' %}">
	<!-- responsive -->
	<link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <style>
                  #main-content{
                  margin:auto;
height:107%;
background: rgb(255,6,154);
background: linear-gradient(273deg, rgba(255,6,154,1) 0%, rgba(21,232,237,1) 40%, rgba(168,168,168,0.02006740196078427) 100%);
     }

    .top-header-area {

  padding: 15px 0;
  width:100%;
}
        #video-container, #captured-image {



            border-radius: 4%;
            border-color: #ff069a;
            border-width: 2px;

margin: 20% auto -1% auto;
             display:none;
                margin-right:-180px;
        }

        #video-stream {

margin: 20% auto auto auto;
            border-radius: 4%;
            border-color: #ff069a;
             margin-right:-10px;



             display:none;
        }

        #button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            flex-flow: row;
            align-content: space-between;
            justify-content: center;

        }

      .inst-container {



    text-align: center;
    padding-top: 5%;

.footer-area{
 position: fixed;
   }


}
#popup{
 margin: 10% auto 0 auto;
padding-top:3%;
 border-radius: 50px;
 background-color: rgba(255, 255, 255, 0.7);
   height: 40%;
    width: 40%;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.);
    font-size: 1px;



    }
.message-container {
            background-color: rgba(255, 255, 255, 0.7);
  font-family: 'Poppins', sans-serif;

            width: 80%;
            align-content: center;
            text-align:center;

            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.);
              font-size: 20px;
              display:none;
        }

.inst-container li{
    margin-bottom: 10px;

}

button.boxed-btn {
  font-family: 'Poppins', sans-serif;
  display: inline-block;
  background-color: #ff069a;
  color: #fff;
  padding: 10px 20px;
  cursor: pointer;

  text-decoration: none;
}

button.boxed-btn {
  border-radius: 50px;
}
button.boxed-btn:hover {
  background-color: #06f7ff;
  color: #fff;
}
button.boxed-btn {
  -webkit-transition: 0.s;
  -o-transition: 0.s;
  transition: 0.s;

}

				.games{
			color: #fff;
		}
		.innerList{
			padding-left: 40px;
            padding-bottom: 19px;
		}
		ul{
           list-style: none;
		}
		#footer{
			justify-content: space-between;
		}
		summary::-webkit-details-marker {
          display: none;}

		  summary {
    list-style-type: none; /* For non-Chrome browsers */}
	.footer-area {
  padding: 120px 0px;

} #retake-button , #next-button{
margin:auto 2%;

width:50%;
height:20%;}
    </style>
<body>

	<!-- header -->
<div class="top-header-area" id="sticker">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-sm-12 text-center">
					<div class="main-menu-wrap">
						<!-- logo -->
						<div class="site-logo">
                            <!--	<a href="{% url 'index' %}"> -->
                                <a href="{% url 'index' %}">	<img src="{% static 'img/Games/GameGeek.png' %}" alt="logo">
                                </a>
                            </div>
						<!-- logo -->

						<!-- menu start -->
						<nav class="main-menu">
							<ul>

								<li>
									<li>

									</li>
								</li>
							</ul>
						</nav>

						<div class="mobile-menu"></div>
						<!-- menu end -->
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- end header -->

    <section id="main-content">






    <div class="inst-container" id="instructions">
        <div id="popup">
            <br>
        <h4 style="color: #ff069bc0;">Welcome again!</h4>
        <h6 >It is time for taking the picture, please follow the instructions:</h6>

            <p>Stay still while taking the picture.</p>
            <p>Make sure the lighting is good.</p>
            <p>Click on <button id="start-camera-button" class="boxed-btn" onclick="hideDiv()">Ready</button> to start taking the picture.</p>


             </div>
    </div>

 <!-- End class row -->

    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg- text-center">


    <br>

    <div id="video-container">
        <video id="video-stream" autoplay playsinline></video>
    </div>

    <img id="captured-image" src="" alt="Captured Image" style="display: none;">

</div>
</div> <!-- End class row -->
</div> <!-- End class container -->
<div class="container">
    <div class="row">
        <div class="col-lg-5 offset-lg-4 text-center">


<div id="button-container">
    <a id="take-snapshot-button" disabled class="boxed-btn" style="display:none;">Take Snapshot</a> <br>
    <a id="retake-button" class="boxed-btn" style="display: none; " onclick="dis()">Retake</a>
    <br>
    <a id="next-button" class="boxed-btn" href="{% url 'Games' %}" style="display: none;">Next</a>
</div>
</div>
</div> <!-- End class row -->
</div> <!-- End class container -->
<br> <br>

<div class="message-container" id="message-container" style="display: none; width:100%;  font-family: 'Poppins', sans-serif;"></div>

</section><!-- End class main-content -->
  <!-- footer -->
	<div class="footer-area">
		<div class="container">
			<div class="row" id="footer">
				<div class="col-lg-3 col-md-6">
					<div class="footer-box about-widget">
						<h2 class="widget-title">Our Guarantee</h2>
						<p>At Game Geek, we combine entertainment along with safeguarding. We're committed to enhancing the game-finding experience by expertly tailoring it to your age and preferences as a cutting-edge platform.</p>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box get-in-touch">
						<h2 class="widget-title">Get in Touch</h2>
						<ul>
							<li>Riyadh, Saudi Arabia.</li>
							<li>support@gamegeek.com</li>
							<li>+00 111 222 3333</li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box pages">
						<h2 class="widget-title">Pages</h2>
						<ul class= "outerList">
							<details><summary><li class="gmaes">Games</li></summary>
								<ul class="innerList">
									<li class="dash"><a href="{% url 'index' %}">All Games</a></li>
									<li class="dash"><a href="{% url 'index' %}">Favourite Games</a></li>
									<li class="dash"><a href="{% url 'index' %}">Downloaded Games</a></li>
								</ul></details>
							<li class="dash"><a href="{% url 'index' %}">Profile</a></li>
							<li class="dash"><a href="{% url 'index' %}">Contact Us</a></li>
							<li class="dash"><a href="{% url 'index' %}">About Us</a></li>
						</ul>

					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end footer -->

	<!-- copyright -->
	<div class="copyright">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<p>Copyrights &copy; 2023 GameGeek Rights Reserved.<br>
					</p>
				</div>
			</div>
		</div>
	</div>
	<!-- end copyright -->
    <script>
        // JavaScript code for capturing and saving the image
        document.addEventListener('DOMContentLoaded', () => {
            const startCameraButton = document.getElementById('start-camera-button');
            const takeSnapshotButton = document.getElementById('take-snapshot-button');
            const retakeButton = document.getElementById('retake-button');
            const capturedImage = document.getElementById('captured-image');
            const videoElement = document.getElementById('video-stream');
            const nextButton = document.getElementById('next-button');

            let mediaStream;
            let snapshotDataUrl;

            startCameraButton.addEventListener('click', async () => {
                try {
                    mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });

                    // Display the video stream in the video element
                    videoElement.srcObject = mediaStream;

                    // Show the video element and hide the captured image
                    videoElement.style.display = 'block';
                    capturedImage.style.display = 'none';

                    // Enable the "Take Snapshot" button
                    takeSnapshotButton.disabled = false;
                    takeSnapshotButton.style.display = 'block';
                } catch (error) {
                    console.error('Error accessing camera:', error);
                }
            });

            takeSnapshotButton.addEventListener('click', () => {
                if (mediaStream) {
                    const canvas = document.createElement('canvas');
                    canvas.width = videoElement.videoWidth;
                    canvas.height = videoElement.videoHeight;
                    const context = canvas.getContext('2d');
                    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

                    // Convert the captured snapshot to base64 data
                    snapshotDataUrl = canvas.toDataURL('image/jpeg');
                    const csrfToken = document.querySelector('input[name=csrfmiddlewaretoken]').value;

                    fetch('/AgeEstimationModel/process_image/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken,
                        },
                        body: JSON.stringify({ image_data: snapshotDataUrl }),
                    })
                    .then(response => response.json())
                    .then(result => {
            if ('error' in result) {
                console.error('Error from model:', result.error);
                displayMessage('No Face Detected. Please try again.');
            } else {
                console.log('Your Estimated Age Group is:', result);

                // Display the result in the message container
                displayMessage(`Your Estimated Age Group is: ${result["Estimated Age Group is: "]}`);
            }
        })
        .catch(error => {
            console.error('Error processing image:', error);
            displayMessage('Error processing image. Please try again.');
        });

        // Function to display messages in the container
        function displayMessage(message) {
            const messageContainer = document.getElementById('message-container');
            messageContainer.style.display = 'block'; // Show the message container
            messageContainer.textContent = message; // Set the message content
        }



                    // Display the captured image and hide the video element
                    capturedImage.src = snapshotDataUrl;
                    capturedImage.style.display = 'block';
                    videoElement.style.display = 'none';

                    // Show the "Retake" and "Save" buttons
                    retakeButton.style.display = 'block';
                    nextButton.style.display = 'block';


                    // Disable the "Take Snapshot" button
                    takeSnapshotButton.style.display = "none";
                }
            });

            retakeButton.addEventListener('click', () => {
                // Reset the captured image and show the video element
                capturedImage.src = '';
                capturedImage.style.display = 'none';
                videoElement.style.display = 'block';

                // Hide the "Retake" and "Save" and "Next" buttons
                retakeButton.style.display = 'none';
                nextButton.style.display = 'none';


                // Enable the "Take Snapshot" button
                takeSnapshotButton.disabled = false;
            });

            nextButton.addEventListener('click', () => {
                // Trigger the download of the captured image
                window.location.href = "/Games/";
            });
        });


        function hideDiv() {
          message = document.getElementById('message-container');
            var div = document.getElementById("instructions");
            take=document.getElementById('take-snapshot-button');
            div.style.display = "none";
             vv=document.getElementById("video-container");
            vv.style.display="block";
             message.style.display = 'none';
              take.style.display="none";
        }
		function dis() {
		  message = document.getElementById('message-container');
		  message.style.display = "none";
            var div = document.getElementById("instructions");
            div.style.display = "block";

take=document.getElementById('take-snapshot-button');
            vv=document.getElementById("video-container");
            vv.style.display="none";
            take.style.display="none";

        }

    </script>
</body>	
{% endblock %}
</html>
